<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة تخمين اللاعب مع الغرف</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f2f2f2;
            color: #333;
            text-align: center;
            direction: rtl;
        }

        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }

        button:hover {
            background-color: #45a049;
        }

        #chatBox {
            max-width: 600px;
            margin: 20px auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #ddd;
            overflow-y: auto;
            height: 300px;
        }

        #chatBox p {
            padding: 5px;
            margin: 5px 0;
            background-color: #f1f1f1;
            border-radius: 5px;
        }

        #timer {
            font-size: 20px;
            margin-top: 20px;
        }

        #playerGuess {
            padding: 10px;
            font-size: 16px;
            margin-top: 20px;
        }

        input {
            padding: 10px;
            font-size: 16px;
            margin-top: 20px;
            width: 80%;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <h1>لعبة تخمين اللاعب مع الغرف</h1>
    <p>ابدأ لعبة التخمين! حاول تخمين اللاعب الصحيح داخل الغرف.</p>
    
    <!-- إنشاء غرفة جديدة -->
    <div>
        <button onclick="createRoom()">إنشاء غرفة جديدة</button>
        <input type="text" id="roomIdInput" placeholder="أدخل رقم الغرفة للانضمام">
        <button onclick="joinRoom()">انضمام إلى غرفة</button>
    </div>

    <!-- شات -->
    <div id="chatBox"></div>
    <input type="text" id="chatInput" placeholder="أكتب رسالة هنا...">
    <button onclick="sendMessage()">إرسال رسالة</button>

    <!-- السؤال والتخمين -->
    <div id="question"></div>
    <input type="text" id="playerGuess" placeholder="تخمين اللاعب">
    <button onclick="submitGuess()">تخمين</button>
    <div id="status"></div>
    <div id="timer"></div>

    <script>
        // Firebase Config
        const firebaseConfig = {
  apiKey: "AIzaSyB0Aj452H6Gp1ociH4ufHrLiU6Uucb-ysM",
  authDomain: "who-is-the-spy-51308.firebaseapp.com",
  databaseURL: "https://who-is-the-spy-51308-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "who-is-the-spy-51308",
  storageBucket: "who-is-the-spy-51308.firebasestorage.app",
  messagingSenderId: "900253646275",
  appId: "1:900253646275:web:b9f7a3cbb1069a07d2d176",
  measurementId: "G-NWXDDDRPRH"
};
        
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database(app);

        let roomId = "";
        let correctPlayer = "فينيسيوس جونيور"; // غيّرها حسب اختيارك
        let currentQuestionIndex = 0;
        let globalTimer = 60;
        let currentRound = 1;
        let playerAnswered = false;
        let userName = "";

        // تسجيل الدخول باستخدام Google
        function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then(result => {
                    const user = result.user;
                    userName = user.displayName;
                    alert(`مرحباً, ${user.displayName}!`);
                })
                .catch(error => console.error(error.message));
        }

        // إنشاء غرفة جديدة
        function createRoom() {
            const roomRef = database.ref('rooms').push();
            roomId = roomRef.key;
            roomRef.set({
                roomId: roomId,
                players: {
                    [userName]: {
                        score: 0
                    }
                },
                currentRound: 1,
                questions: [
                    "هل هو لاعب كرة قدم؟",
                    "هل هو في الدوري الإسباني؟",
                    "هل هو مهاجم؟",
                    "هل هو لاعب برازيلي؟",
                    "هل هو في ريال مدريد؟",
                    "هل هو في برشلونة؟",
                    "هل هو حارس مرمى؟",
                    "هل هو في الدوري الإنجليزي؟"
                ]
            }).then(() => {
                alert(`تم إنشاء الغرفة بنجاح! رقم الغرفة: ${roomId}`);
                startGame();
            });
        }

        // الانضمام إلى غرفة موجودة
        function joinRoom() {
            const enteredRoomId = document.getElementById("roomIdInput").value;
            if (enteredRoomId === "") {
                alert("من فضلك أدخل رقم الغرفة.");
                return;
            }

            const roomRef = database.ref('rooms/' + enteredRoomId);
            roomRef.once('value', snapshot => {
                if (snapshot.exists()) {
                    roomId = enteredRoomId;
                    const roomData = snapshot.val();
                    roomData.players[userName] = { score: 0 }; // إضافة اللاعب إلى الغرفة
                    roomRef.update({
                        players: roomData.players
                    }).then(() => {
                        alert(`تم الانضمام إلى الغرفة: ${roomId}`);
                        startGame();
                    });
                } else {
                    alert("الغرفة غير موجودة.");
                }
            });
        }

        // بدء اللعبة
        function startGame() {
            displayRandomQuestion();
            startGlobalTimer();
            displayChat();
        }

        // عرض سؤال عشوائي
        function displayRandomQuestion() {
            const roomRef = database.ref('rooms/' + roomId);
            roomRef.once('value', snapshot => {
                const roomData = snapshot.val();
                const randomIndex = Math.floor(Math.random() * roomData.questions.length);
                const questionElement = document.getElementById("question");
                questionElement.innerHTML = `
                    <p>${roomData.questions[randomIndex]}</p>
                `;
            });
        }

        // إرسال التخمين
        function submitGuess() {
            const playerGuess = document.getElementById("playerGuess").value;
            if (!playerGuess) {
                alert("من فضلك أدخل تخمينك!");
                return;
            }

            const statusElement = document.getElementById("status");
            if (playerGuess === correctPlayer) {
                statusElement.innerHTML = `<p>أنت اكتشفت اللاعب! هو ${correctPlayer}</p>`;
                savePlayerStats(true);
                stopGlobalTimer();
            } else {
                statusElement.innerHTML = `<p>تخمينك غلط! حاول مرة تانية.</p>`;
                savePlayerStats(false);
            }
        }

        // حفظ إحصائيات اللاعب
        function savePlayerStats(correctAnswer) {
            const roomRef = database.ref('rooms/' + roomId);
            roomRef.once('value', snapshot => {
                const roomData = snapshot.val();
                roomData.players[userName].score += correctAnswer ? 1 : 0;
                roomRef.update({
                    players: roomData.players
                });
            });
        }

        // مؤقت عالمي (عرض الوقت المتبقي)
        function startGlobalTimer() {
            setInterval(() => {
                if (globalTimer > 0) {
                    globalTimer--;
                    document.getElementById("timer").innerText = `الوقت المتبقي: ${globalTimer} ثانية`;
                } else {
                    alert("انتهى الوقت!");
                    stopGlobalTimer();
                }
            }, 1000);
        }

        function stopGlobalTimer() {
            globalTimer = 0;
            document.getElementById("timer").innerText = `انتهى الوقت!`;
        }

        // إرسال رسالة في الشات
        function sendMessage() {
            const message = document.getElementById("chatInput").value;
            if (message.trim() === "") return;

            const chatRef = database.ref('rooms/' + roomId + '/chatMessages/');
            chatRef.push({
                user: userName,
                message: message,
                timestamp: Date.now()
            });

            document.getElementById("chatInput").value = "";
        }

        // عرض الشات
        function displayChat() {
            const chatRef = database.ref('rooms/' + roomId + '/chatMessages/');
            chatRef.on('child_added', snapshot => {
                const message = snapshot.val();
                const chatBox = document.getElementById("chatBox");
                const messageElement = document.createElement("p");
                messageElement.textContent = `${message.user}: ${message.message}`;
                chatBox.appendChild(messageElement);
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        }

        // تسجيل الدخول عند بداية اللعبة
        loginWithGoogle();
    </script>
</body>
</html>
