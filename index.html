<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNO Online</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .card {
            display: inline-block;
            margin: 10px;
            padding: 20px;
            border-radius: 10px;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
        }
        .red { background-color: red; }
        .blue { background-color: blue; }
        .yellow { background-color: yellow; color: #000; }
        .green { background-color: green; }
        .wild { background-color: black; }
        #login-container, #game-container {
            display: none;
        }
        #deck { font-size: 1.5em; }
        #players-list { list-style: none; padding: 0; }
    </style>
</head>
<body>
    <!-- صفحة تسجيل الدخول -->
    <div id="login-container">
        <h1>UNO Online</h1>
        <button id="google-login">Login with Google</button>
    </div>

    <!-- صفحة اللعبة -->
    <div id="game-container">
        <h1>UNO Game</h1>
        <div id="game-info">
            <p id="current-turn"></p>
            <div id="deck"></div>
        </div>
        <ul id="players-list"></ul>
        <div id="player-hand"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.8/firebase-database.js"></script>
    <script>
        // تهيئة Firebase
        const firebaseConfig = {
  apiKey: "AIzaSyB0Aj452H6Gp1ociH4ufHrLiU6Uucb-ysM",
  authDomain: "who-is-the-spy-51308.firebaseapp.com",
  databaseURL: "https://who-is-the-spy-51308-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "who-is-the-spy-51308",
  storageBucket: "who-is-the-spy-51308.firebasestorage.app",
  messagingSenderId: "900253646275",
  appId: "1:900253646275:web:b9f7a3cbb1069a07d2d176",
  measurementId: "G-NWXDDDRPRH"
};
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // المتغيرات العامة
        let currentUser = null;
        let roomId = null;
        let players = [];
        let currentPlayerIndex = 0;
        let deck = [];
        let openCard = null;
        let direction = 1;

        // عرض صفحة تسجيل الدخول
        document.getElementById('login-container').style.display = 'block';

        // تسجيل الدخول باستخدام Google
        document.getElementById('google-login').addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then(result => {
                currentUser = result.user;
                document.getElementById('login-container').style.display = 'none';
                showGame();
            }).catch(error => {
                alert('Error during login: ' + error.message);
            });
        });

        // عرض واجهة اللعبة
        function showGame() {
            document.getElementById('game-container').style.display = 'block';
            initializeGame();
        }

        // تهيئة اللعبة
        function initializeGame() {
            createDeck();
            shuffleDeck();
            dealCards();

            // إنشاء غرفة في Firebase
            roomId = `room_${Date.now()}`;
            db.ref(`rooms/${roomId}`).set({
                players: players,
                deck: deck,
                openCard: openCard,
                direction: direction,
                currentPlayerIndex: currentPlayerIndex
            });

            updateGameBoard();
        }

        // إنشاء مجموعة البطاقات
        function createDeck() {
            const colors = ['red', 'blue', 'yellow', 'green'];
            const specialCards = ['Skip', 'Reverse', 'Draw Two'];
            const wildCards = ['Wild', 'Wild Draw Four'];

            colors.forEach(color => {
                for (let i = 0; i <= 9; i++) {
                    deck.push({ color, value: i });
                    if (i !== 0) deck.push({ color, value: i });
                }
                specialCards.forEach(card => {
                    deck.push({ color, value: card });
                    deck.push({ color, value: card });
                });
            });

            wildCards.forEach(card => {
                for (let i = 0; i < 4; i++) {
                    deck.push({ color: 'wild', value: card });
                }
            });
        }

        // خلط البطاقات
        function shuffleDeck() {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        // توزيع البطاقات
        function dealCards() {
            players = [{ name: currentUser.displayName, cards: [] }];
            for (let i = 0; i < 7; i++) {
                players[0].cards.push(deck.pop());
            }
            openCard = deck.pop();
        }

        // تحديث واجهة اللعبة
        function updateGameBoard() {
            const openCardDiv = document.getElementById('deck');
            openCardDiv.innerText = `${openCard.value}`;
            openCardDiv.className = `card ${openCard.color}`;

            const playersList = document.getElementById('players-list');
            playersList.innerHTML = '';
            players.forEach((player, index) => {
                const li = document.createElement('li');
                li.innerText = `${player.name} - ${player.cards.length} cards`;
                if (index === currentPlayerIndex) li.style.fontWeight = 'bold';
                playersList.appendChild(li);
            });

            document.getElementById('current-turn').innerText = `Turn: ${players[currentPlayerIndex].name}`;
            const playerHand = document.getElementById('player-hand');
            playerHand.innerHTML = '';
            players[0].cards.forEach((card, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = `card ${card.color}`;
                cardDiv.innerText = card.value;
                cardDiv.addEventListener('click', () => playCard(index));
                playerHand.appendChild(cardDiv);
            });
        }

        // اللعب
        function playCard(cardIndex) {
            const card = players[0].cards[cardIndex];
            if (card.color !== openCard.color && card.value !== openCard.value && card.color !== 'wild') {
                alert('Invalid move!');
                return;
            }
            openCard = card;
            players[0].cards.splice(cardIndex, 1);

            if (players[0].cards.length === 0) {
                alert(`${players[0].name} wins!`);
                return;
            }

            currentPlayerIndex = (currentPlayerIndex + direction + players.length) % players.length;
            updateGameBoard();
        }
    </script>
</body>
</html>
